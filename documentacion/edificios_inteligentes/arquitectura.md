# Descripción de la arquitectura

El sistema de control inteligente MeshControl está formado por una serie de componentes que abarca desde los sensores y actuadores anteriormente nombrados, al software y hardware de la unidad interior. La tecnología de la que se compone MeshControl es abierta, permitiendo y facilitando su acceso a fabricantes e instaladores que quieran implementarla en sus sistemas. Por ello, la licencia bajo la que se distribuirá el producto es GPL (General Public License), lo que garantiza la colaboración entre los usuarios y redunda en una mejora continua del sistema. 

## Hardware

Siguiendo los principios de la tecnología abierta, el hardware del proyecto se ha desarrollado bajo licencias libres de manera que esta solución se pueda replicar en otras aplicaciones o modificar para adaptarlo a las necesidades específicas de una instalación. Por ello, el hadware específico desarrollado para este proyecto está basado en los microcontroladores de Atmel, que son el corazón de Arduino. Para los módulos que necesiten prestaciones más altas se usa la Raspberry Pi y el hardware Olimex. 
El dispositivo físico que se dispondrá en cada instalación solar está basado en una PCB (Printed Circuit Board), a la cual se ha integrado uno de estos microcontroladores que se encarga del control de la información. Junto al microcontrolaador se incluye también el integrado ESP 8266, fabricado por Espressif, un módulo WIFI de fácil manejo y muy económico, capaz de conectar cualquier dispositivo a la red y cuyo uso se está extendiendo notablemente en las soluciones de IoT. Este chip es por tanto el encargado de transmitir la información recibida a la nube.

## Software

La información obtenida a través de los distintos canales de entrada se almacena en una base de datos localizada en la nube, concretamente en un servidor habilitado para cada instalación. La transmisión de información desde la fuente local al servidor se realiza mediante protocolos Restful y Mqtt, este último muy usado en soluciones IoT debido al poco consumo de recursos que conlleva. A diferencia de otros sistemas de control, diseñados para sistemas solares, el software específico de MeshControl se aloja directamente en el servidor, de manera que la información recibida es procesada directamente ahí. Este hecho constituye una ventaja fundamental, ya que facilita su acceso desde cualquier punto con conexión a internet a la vez que se favorece la integración con otros servicios que alojados en la nube. El servidor desarrollado está basado en PHP y JavaScript que permiten tanto al técnico responsable como al usuario final acceder directamente a sus datos registrados, visualizar estadísticas y consumos o modificar parámetros de funcionamiento del sistema. Para ello, se ha tomado como referencia el software Emoncms, el cual se ha modificado para cubrir las exigencias de los sistemas solares híbridos.
La comunicación entre el servidor y actuadores se ejecuta también mediante protocolos Restful y Mqtt. Se ha hecho especial hincapié en el uso de protocolos web y redes WIFI con el fin de aumentar la flexibilidad del sistema de control, ya que de esta manera se reducen las infraestructuras de cableado y sus problemas típicos asociados. Además, actualmente los dispositivos WIFI son una tecnología robusta, extendida y de precio muy competitivo, que junto con el envío de información mediante protocolo Mqtt redunda en un consumo de energía muy reducido.

[MODIFICAR IMAGEN]

La implementación del servidor en la nube respalda directamente la premisa del Internet de las Cosas, ya que la información se recibe, se muestra y se gestiona desde internet. Este tratamiento presenta varias ventajas clave sobre otros sistemas de control efectuados en tecnologías solares. En primer lugar transporta el sistema de control fuera de la instalación física, lo que evita el traslado del técnico especialista hasta el entorno real cada vez que haya que ejecutar una modificación o reparar una avería. Por contra, ese control se lleva a un entorno en la nube que es fácilmente accesible por todos los agentes (técnico, instalador, usuario final) y al que se puede llegar con una simple conexión a internet. Al crear un servidor para cada instalación se reduce el riesgo de provocar problemas que afecten a un gran número de usuarios, mientras que se favorece por otra parte, la adecuación del software a las necesidades de cada instalación en particular. Por último, generar un entorno en la nube donde el usuario final pueda revisar periódicamente la producción y consumos de su vivienda, ayuda a visualizar y a tomar conciencia de su propia gestión energética y de los beneficios obtenidos mediante el control inteligente de la instalación solar, lo que puede contribuir a aumentar la confianza en dicha tecnología.

## La robustez del sistema
Los microcontroladores, que recopilan la información de la red de sensores y ejecutan las acciones, leen del sistema en la nube cual debe ser su comportamiento (actualizan su software) lo que protege a MEshControl contra fallos en las comunicaciones o en el propio servidor. Esta característica proporciona un sistema robusto que funcionará ante cualquier contingencia y que a la vez se beneficia de todas las ventajas de estar en la nube.
